---
url: "https://platform.claude.com/docs/en/agent-sdk/mcp"
title: "MCP in the SDK - Claude Docs"
---

[Claude Documentation Home](https://platform.claude.com/docs/en/home)

- [Developer Guide](https://platform.claude.com/docs/en/intro)
- [API Reference](https://platform.claude.com/docs/en/api/overview)
- [MCP](https://modelcontextprotocol.io/)
- [Resources](https://platform.claude.com/docs/en/resources/overview)
- [Release Notes](https://platform.claude.com/docs/en/release-notes/overview)

English

[Log in](https://platform.claude.com/login?returnTo=%2Fdocs%2Fen%2Fagent-sdk%2Fmcp)

Search...

âŒ˜K

First steps

[Intro to Claude](https://platform.claude.com/docs/en/intro) [Quickstart](https://platform.claude.com/docs/en/get-started)

Models & pricing

[Models overview](https://platform.claude.com/docs/en/about-claude/models/overview) [Choosing a model](https://platform.claude.com/docs/en/about-claude/models/choosing-a-model) [What's new in Claude 4.5](https://platform.claude.com/docs/en/about-claude/models/whats-new-claude-4-5) [Migrating to Claude 4.5](https://platform.claude.com/docs/en/about-claude/models/migrating-to-claude-4) [Model deprecations](https://platform.claude.com/docs/en/about-claude/model-deprecations) [Pricing](https://platform.claude.com/docs/en/about-claude/pricing)

Build with Claude

[Features overview](https://platform.claude.com/docs/en/build-with-claude/overview) [Using the Messages API](https://platform.claude.com/docs/en/build-with-claude/working-with-messages) [Context windows](https://platform.claude.com/docs/en/build-with-claude/context-windows) [Prompting best practices](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/claude-4-best-practices)

Capabilities

[Prompt caching](https://platform.claude.com/docs/en/build-with-claude/prompt-caching) [Context editing](https://platform.claude.com/docs/en/build-with-claude/context-editing) [Extended thinking](https://platform.claude.com/docs/en/build-with-claude/extended-thinking) [Effort](https://platform.claude.com/docs/en/build-with-claude/effort) [Streaming Messages](https://platform.claude.com/docs/en/build-with-claude/streaming) [Batch processing](https://platform.claude.com/docs/en/build-with-claude/batch-processing) [Citations](https://platform.claude.com/docs/en/build-with-claude/citations) [Multilingual support](https://platform.claude.com/docs/en/build-with-claude/multilingual-support) [Token counting](https://platform.claude.com/docs/en/build-with-claude/token-counting) [Embeddings](https://platform.claude.com/docs/en/build-with-claude/embeddings) [Vision](https://platform.claude.com/docs/en/build-with-claude/vision) [PDF support](https://platform.claude.com/docs/en/build-with-claude/pdf-support) [Files API](https://platform.claude.com/docs/en/build-with-claude/files) [Search results](https://platform.claude.com/docs/en/build-with-claude/search-results) [Structured outputs](https://platform.claude.com/docs/en/build-with-claude/structured-outputs) [Google Sheets add-on](https://platform.claude.com/docs/en/agents-and-tools/claude-for-sheets)

Tools

[Overview](https://platform.claude.com/docs/en/agents-and-tools/tool-use/overview) [How to implement tool use](https://platform.claude.com/docs/en/agents-and-tools/tool-use/implement-tool-use) [Fine-grained tool streaming](https://platform.claude.com/docs/en/agents-and-tools/tool-use/fine-grained-tool-streaming) [Bash tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/bash-tool) [Code execution tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/code-execution-tool) [Programmatic tool calling](https://platform.claude.com/docs/en/agents-and-tools/tool-use/programmatic-tool-calling) [Computer use tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/computer-use-tool) [Text editor tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/text-editor-tool) [Web fetch tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/web-fetch-tool) [Web search tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/web-search-tool) [Memory tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/memory-tool) [Tool search tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/tool-search-tool)

Agent Skills

[Overview](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/overview) [Quickstart](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/quickstart) [Best practices](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/best-practices) [Using Skills with the API](https://platform.claude.com/docs/en/build-with-claude/skills-guide)

Agent SDK

[Overview](https://platform.claude.com/docs/en/agent-sdk/overview) [Quickstart](https://platform.claude.com/docs/en/agent-sdk/quickstart) [TypeScript SDK](https://platform.claude.com/docs/en/agent-sdk/typescript) [TypeScript V2 (preview)](https://platform.claude.com/docs/en/agent-sdk/typescript-v2-preview) [Python SDK](https://platform.claude.com/docs/en/agent-sdk/python) [Migration Guide](https://platform.claude.com/docs/en/agent-sdk/migration-guide) Guides

[Streaming Input](https://platform.claude.com/docs/en/agent-sdk/streaming-vs-single-mode) [Handling Permissions](https://platform.claude.com/docs/en/agent-sdk/permissions) [Session Management](https://platform.claude.com/docs/en/agent-sdk/sessions) [Structured outputs in the SDK](https://platform.claude.com/docs/en/agent-sdk/structured-outputs) [Hosting the Agent SDK](https://platform.claude.com/docs/en/agent-sdk/hosting) [Securely deploying AI agents](https://platform.claude.com/docs/en/agent-sdk/secure-deployment) [Modifying system prompts](https://platform.claude.com/docs/en/agent-sdk/modifying-system-prompts) [MCP in the SDK](https://platform.claude.com/docs/en/agent-sdk/mcp) [Custom Tools](https://platform.claude.com/docs/en/agent-sdk/custom-tools) [Subagents in the SDK](https://platform.claude.com/docs/en/agent-sdk/subagents) [Slash Commands in the SDK](https://platform.claude.com/docs/en/agent-sdk/slash-commands) [Agent Skills in the SDK](https://platform.claude.com/docs/en/agent-sdk/skills) [Tracking Costs and Usage](https://platform.claude.com/docs/en/agent-sdk/cost-tracking) [Todo Lists](https://platform.claude.com/docs/en/agent-sdk/todo-tracking) [Plugins in the SDK](https://platform.claude.com/docs/en/agent-sdk/plugins)

MCP in the API

[MCP connector](https://platform.claude.com/docs/en/agents-and-tools/mcp-connector) [Remote MCP servers](https://platform.claude.com/docs/en/agents-and-tools/remote-mcp-servers)

Claude on 3rd-party platforms

[Amazon Bedrock](https://platform.claude.com/docs/en/build-with-claude/claude-on-amazon-bedrock) [Microsoft Foundry](https://platform.claude.com/docs/en/build-with-claude/claude-in-microsoft-foundry) [Vertex AI](https://platform.claude.com/docs/en/build-with-claude/claude-on-vertex-ai)

Prompt engineering

[Overview](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/overview) [Prompt generator](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/prompt-generator) [Use prompt templates](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/prompt-templates-and-variables) [Prompt improver](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/prompt-improver) [Be clear and direct](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/be-clear-and-direct) [Use examples (multishot prompting)](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/multishot-prompting) [Let Claude think (CoT)](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/chain-of-thought) [Use XML tags](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/use-xml-tags) [Give Claude a role (system prompts)](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/system-prompts) [Prefill Claude's response](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/prefill-claudes-response) [Chain complex prompts](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/chain-prompts) [Long context tips](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/long-context-tips) [Extended thinking tips](https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/extended-thinking-tips)

Test & evaluate

[Define success criteria](https://platform.claude.com/docs/en/test-and-evaluate/define-success) [Develop test cases](https://platform.claude.com/docs/en/test-and-evaluate/develop-tests) [Using the Evaluation Tool](https://platform.claude.com/docs/en/test-and-evaluate/eval-tool) [Reducing latency](https://platform.claude.com/docs/en/test-and-evaluate/strengthen-guardrails/reduce-latency)

Strengthen guardrails

[Reduce hallucinations](https://platform.claude.com/docs/en/test-and-evaluate/strengthen-guardrails/reduce-hallucinations) [Increase output consistency](https://platform.claude.com/docs/en/test-and-evaluate/strengthen-guardrails/increase-consistency) [Mitigate jailbreaks](https://platform.claude.com/docs/en/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks) [Streaming refusals](https://platform.claude.com/docs/en/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals) [Reduce prompt leak](https://platform.claude.com/docs/en/test-and-evaluate/strengthen-guardrails/reduce-prompt-leak) [Keep Claude in character](https://platform.claude.com/docs/en/test-and-evaluate/strengthen-guardrails/keep-claude-in-character)

Administration and monitoring

[Admin API overview](https://platform.claude.com/docs/en/build-with-claude/administration-api) [Usage and Cost API](https://platform.claude.com/docs/en/build-with-claude/usage-cost-api) [Claude Code Analytics API](https://platform.claude.com/docs/en/build-with-claude/claude-code-analytics-api)

[Console](https://platform.claude.com/)

[Log in](https://platform.claude.com/login)

Guides

MCP in the SDK

Guides

# MCP in the SDK

Copy page

Extend Claude Code with custom tools using Model Context Protocol servers

Copy page

## Overview

Model Context Protocol (MCP) servers extend Claude Code with custom tools and capabilities. MCPs can run as external processes, connect via HTTP/SSE, or execute directly within your SDK application.

## Configuration

### Basic Configuration

Configure MCP servers in `.mcp.json` at your project root:

TypeScript

```
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-filesystem"],
      "env": {
        "ALLOWED_PATHS": "/Users/me/projects"
      }
    }
  }
}
```

### Using MCP Servers in SDK

TypeScript

```
import { query } from "@anthropic-ai/claude-agent-sdk";

for await (const message of query({
  prompt: "List files in my project",
  options: {
    mcpServers: {
      "filesystem": {
        command: "npx",
        args: ["@modelcontextprotocol/server-filesystem"],
        env: {
          ALLOWED_PATHS: "/Users/me/projects"
        }
      }
    },
    allowedTools: ["mcp__filesystem__list_files"]
  }
})) {
  if (message.type === "result" && message.subtype === "success") {
    console.log(message.result);
  }
}
```

## Transport Types

### stdio Servers

External processes communicating via stdin/stdout:

TypeScript

```
// .mcp.json configuration
{
  "mcpServers": {
    "my-tool": {
      "command": "node",
      "args": ["./my-mcp-server.js"],
      "env": {
        "DEBUG": "${DEBUG:-false}"
      }
    }
  }
}
```

### HTTP/SSE Servers

Remote servers with network communication:

TypeScript

```
// SSE server configuration
{
  "mcpServers": {
    "remote-api": {
      "type": "sse",
      "url": "https://api.example.com/mcp/sse",
      "headers": {
        "Authorization": "Bearer ${API_TOKEN}"
      }
    }
  }
}

// HTTP server configuration
{
  "mcpServers": {
    "http-service": {
      "type": "http",
      "url": "https://api.example.com/mcp",
      "headers": {
        "X-API-Key": "${API_KEY}"
      }
    }
  }
}
```

### SDK MCP Servers

In-process servers running within your application. For detailed information on creating custom tools, see the [Custom Tools guide](https://platform.claude.com/docs/en/agent-sdk/custom-tools):

## Resource Management

MCP servers can expose resources that Claude can list and read:

TypeScript

```
import { query } from "@anthropic-ai/claude-agent-sdk";

// List available resources
for await (const message of query({
  prompt: "What resources are available from the database server?",
  options: {
    mcpServers: {
      "database": {
        command: "npx",
        args: ["@modelcontextprotocol/server-database"]
      }
    },
    allowedTools: ["mcp__list_resources", "mcp__read_resource"]
  }
})) {
  if (message.type === "result") console.log(message.result);
}
```

## Authentication

### Environment Variables

TypeScript

```
// .mcp.json with environment variables
{
  "mcpServers": {
    "secure-api": {
      "type": "sse",
      "url": "https://api.example.com/mcp",
      "headers": {
        "Authorization": "Bearer ${API_TOKEN}",
        "X-API-Key": "${API_KEY:-default-key}"
      }
    }
  }
}

// Set environment variables
process.env.API_TOKEN = "your-token";
process.env.API_KEY = "your-key";
```

### OAuth2 Authentication

OAuth2 MCP authentication in-client is not currently supported.

## Error Handling

Handle MCP connection failures gracefully:

TypeScript

```
import { query } from "@anthropic-ai/claude-agent-sdk";

for await (const message of query({
  prompt: "Process data",
  options: {
    mcpServers: {
      "data-processor": dataServer
    }
  }
})) {
  if (message.type === "system" && message.subtype === "init") {
    // Check MCP server status
    const failedServers = message.mcp_servers.filter(
      s => s.status !== "connected"
    );

    if (failedServers.length > 0) {
      console.warn("Failed to connect:", failedServers);
    }
  }

  if (message.type === "result" && message.subtype === "error_during_execution") {
    console.error("Execution failed");
  }
}
```

## Related Resources

- [Custom Tools Guide](https://platform.claude.com/docs/en/agent-sdk/custom-tools) \- Detailed guide on creating SDK MCP servers
- [TypeScript SDK Reference](https://platform.claude.com/docs/en/agent-sdk/typescript)
- [Python SDK Reference](https://platform.claude.com/docs/en/agent-sdk/python)
- [SDK Permissions](https://platform.claude.com/docs/en/agent-sdk/permissions)
- [Common Workflows](https://code.claude.com/docs/en/common-workflows)

- [Overview](https://platform.claude.com/docs/en/agent-sdk/mcp#overview)
- [Configuration](https://platform.claude.com/docs/en/agent-sdk/mcp#configuration)
- [Basic Configuration](https://platform.claude.com/docs/en/agent-sdk/mcp#basic-configuration)
- [Using MCP Servers in SDK](https://platform.claude.com/docs/en/agent-sdk/mcp#using-mcp-servers-in-sdk)
- [Transport Types](https://platform.claude.com/docs/en/agent-sdk/mcp#transport-types)
- [stdio Servers](https://platform.claude.com/docs/en/agent-sdk/mcp#stdio-servers)
- [HTTP/SSE Servers](https://platform.claude.com/docs/en/agent-sdk/mcp#http-sse-servers)
- [SDK MCP Servers](https://platform.claude.com/docs/en/agent-sdk/mcp#sdk-mcp-servers)
- [Resource Management](https://platform.claude.com/docs/en/agent-sdk/mcp#resource-management)
- [Authentication](https://platform.claude.com/docs/en/agent-sdk/mcp#authentication)
- [Environment Variables](https://platform.claude.com/docs/en/agent-sdk/mcp#environment-variables)
- [OAuth2 Authentication](https://platform.claude.com/docs/en/agent-sdk/mcp#o-auth2-authentication)
- [Error Handling](https://platform.claude.com/docs/en/agent-sdk/mcp#error-handling)
- [Related Resources](https://platform.claude.com/docs/en/agent-sdk/mcp#related-resources)

[Claude Docs home page](https://platform.claude.com/docs)

[X (Twitter)](https://x.com/claudeai)[LinkedIn](https://www.linkedin.com/showcase/claude)[Instagram](https://instagram.com/claudeai)

### Solutions

- [AI agents](https://claude.com/solutions/agents)
- [Code modernization](https://claude.com/solutions/code-modernization)
- [Coding](https://claude.com/solutions/coding)
- [Customer support](https://claude.com/solutions/customer-support)
- [Education](https://claude.com/solutions/education)
- [Financial services](https://claude.com/solutions/financial-services)
- [Government](https://claude.com/solutions/government)
- [Life sciences](https://claude.com/solutions/life-sciences)

### Partners

- [Amazon Bedrock](https://claude.com/partners/amazon-bedrock)
- [Google Cloud's Vertex AI](https://claude.com/partners/google-cloud-vertex-ai)

### Learn

- [Blog](https://claude.com/blog)
- [Catalog](https://claude.ai/catalog/artifacts)
- [Courses](https://www.anthropic.com/learn)
- [Use cases](https://claude.com/resources/use-cases)
- [Connectors](https://claude.com/partners/mcp)
- [Customer stories](https://claude.com/customers)
- [Engineering at Anthropic](https://www.anthropic.com/engineering)
- [Events](https://www.anthropic.com/events)
- [Powered by Claude](https://claude.com/partners/powered-by-claude)
- [Service partners](https://claude.com/partners/services)
- [Startups program](https://claude.com/programs/startups)

### Company

- [Anthropic](https://www.anthropic.com/company)
- [Careers](https://www.anthropic.com/careers)
- [Economic Futures](https://www.anthropic.com/economic-futures)
- [Research](https://www.anthropic.com/research)
- [News](https://www.anthropic.com/news)
- [Responsible Scaling Policy](https://www.anthropic.com/news/announcing-our-updated-responsible-scaling-policy)
- [Security and compliance](https://trust.anthropic.com/)
- [Transparency](https://www.anthropic.com/transparency)

### Learn

- [Blog](https://claude.com/blog)
- [Catalog](https://claude.ai/catalog/artifacts)
- [Courses](https://www.anthropic.com/learn)
- [Use cases](https://claude.com/resources/use-cases)
- [Connectors](https://claude.com/partners/mcp)
- [Customer stories](https://claude.com/customers)
- [Engineering at Anthropic](https://www.anthropic.com/engineering)
- [Events](https://www.anthropic.com/events)
- [Powered by Claude](https://claude.com/partners/powered-by-claude)
- [Service partners](https://claude.com/partners/services)
- [Startups program](https://claude.com/programs/startups)

### Help and security

- [Availability](https://www.anthropic.com/supported-countries)
- [Status](https://status.anthropic.com/)
- [Support](https://support.claude.com/)
- [Discord](https://www.anthropic.com/discord)

### Terms and policies

- [Privacy policy](https://www.anthropic.com/legal/privacy)
- [Responsible disclosure policy](https://www.anthropic.com/responsible-disclosure-policy)
- [Terms of service: Commercial](https://www.anthropic.com/legal/commercial-terms)
- [Terms of service: Consumer](https://www.anthropic.com/legal/consumer-terms)
- [Usage policy](https://www.anthropic.com/legal/aup)

Ask Docs
![Chat avatar](https://platform.claude.com/docs/images/book-icon-light.svg)

a.claude.ai

# a.claude.ai is blocked

**a.claude.ai** refused to connect.

ERR\_BLOCKED\_BY\_RESPONSE

**a.claude.ai** refused to connect.

![](<Base64-Image-Removed>)![](<Base64-Image-Removed>)

Invalid domain for site key.

ERROR for site owner:

Invalid domain for site key

reCAPTCHA

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)