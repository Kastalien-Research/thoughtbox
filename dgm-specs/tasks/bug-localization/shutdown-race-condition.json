{
  "id": "bug-loc-002-shutdown-race",
  "variant": "clean",
  "name": "Graceful Shutdown Race Condition",
  "description": "HTTP server shutdown has race condition - database cleanup starts before in-flight requests complete, risking data corruption",

  "gitCommit": "3b2b7787ca48a41b8a277a7e78e0f545fa2d980e~1",
  "fixCommit": "3b2b7787ca48a41b8a277a7e78e0f545fa2d980e",

  "errorMessage": "Potential data corruption during shutdown - database closes before in-flight requests complete",

  "affectedFiles": [
    "src/http.ts"
  ],
  "correctFile": "src/http.ts",

  "successCriteria": "Capture server instance from app.listen(), use server.close() to stop accepting new connections, wait for in-flight requests before database cleanup",

  "expectedThoughtboxBenefit": "Thoughtbox helps trace async shutdown sequence without getting lost in unrelated server code",
  "estimatedTokens": 2500
}
