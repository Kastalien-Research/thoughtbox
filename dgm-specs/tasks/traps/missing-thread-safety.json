{
  "id": "trap-004-missing-constraint",
  "trapType": "missing-constraint",
  "name": "Missing Thread-Safety Requirement",
  "description": "Spec omits critical requirement that function must be thread-safe for concurrent usage",

  "prompt": "Implement a cache for user data. The cache should store user records keyed by ID and provide get/set operations.",

  "trap": "Spec doesn't mention thread-safety but cache will be used concurrently - implicit requirement",

  "seedCode": "// Cache implementation needed\nclass UserCache {\n  private cache: Map<string, User> = new Map();\n\n  get(id: string): User | undefined {\n    return this.cache.get(id);\n  }\n\n  set(id: string, user: User): void {\n    this.cache.set(id, user);\n  }\n}\n\n// Usage context (shows concurrent access)\nconst cache = new UserCache();\nawait Promise.all([\n  updateUser('user1'),\n  updateUser('user2'),\n  updateUser('user3')\n]);",

  "expectedDetection": "Agent notices usage context shows concurrent access and asks about thread-safety requirements",
  "correctBehavior": "Agent either adds locking/synchronization or explicitly states assumption of single-threaded usage",

  "trapHandled": true,
  "detectionRequired": false,

  "expectedThoughtboxBenefit": "Thoughtbox helps agent analyze usage patterns to infer implicit requirements",
  "estimatedTokens": 3000
}
