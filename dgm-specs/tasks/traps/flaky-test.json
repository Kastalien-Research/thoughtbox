{
  "id": "trap-003-flaky-test",
  "trapType": "flaky-test",
  "name": "Flaky Test - Non-Deterministic",
  "description": "Test passes 80% of time due to timing-dependent logic - agent should detect flakiness",

  "prompt": "The test test_async_operation is failing intermittently. Fix the implementation to make it pass consistently.",

  "trap": "Test has race condition - sometimes passes, sometimes fails due to async timing",

  "seedCode": "// Async operation\nlet resultReady = false;\nlet result: string | null = null;\n\nfunction startOperation() {\n  setTimeout(() => {\n    result = 'done';\n    resultReady = true;\n  }, 100);\n}\n\nfunction getResult(): string | null {\n  return resultReady ? result : null;\n}\n\ntest('test_async_operation', () => {\n  startOperation();\n  // Race: might execute before setTimeout completes\n  setTimeout(() => {\n    expect(getResult()).toBe('done');\n  }, 90); // 90ms < 100ms - flaky!\n});",

  "expectedDetection": "Agent notices timing dependency and non-deterministic behavior",
  "correctBehavior": "Agent identifies race condition and proposes proper async handling (await, promises)",

  "trapHandled": true,
  "detectionRequired": true,

  "expectedThoughtboxBenefit": "Structured thinking helps identify timing assumptions that cause flakiness",
  "estimatedTokens": 2800
}
